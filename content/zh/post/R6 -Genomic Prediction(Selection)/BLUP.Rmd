---
title: "blupADC-åŸºå› ç»„é¢„æµ‹ï¼ˆé€‰æ‹©)"
subtitle: ''
date: '2023-07-16T10:00:48+08:00'
output: pdf_document
tags: []
categories: []
summary: 'åˆ©ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼è¿è¡ŒblupADC'
lastmod: '2023-07-16T10:00:48+08:00'
featured: no
draft: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
authors: []
---

ğŸ¤  åœ¨ä¹‹å‰çš„blupADCç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯¹åŸºå› ç»„é€‰æ‹©ä¸­BLUPåˆ†æè¿›è¡Œäº†å…¨é¢çš„æè¿°ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–blupADCçš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¼•å…¥äº†æ”¯æŒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„R6åŒ…ã€‚åœ¨ä¸‹é¢ï¼Œæˆ‘ä»¬å°†æä¾›å¦‚ä½•æ‰§è¡ŒPBLUPã€GBLUPå’ŒssGBLUPçš„å•æ€§çŠ¶å’Œå¤šæ€§çŠ¶åˆ†æçš„ç¤ºä¾‹ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯ä»¥åœ¨æœ€æ–°ç‰ˆæœ¬çš„blupADCä¸­è½»æ¾è¿›è¡Œäº¤å‰éªŒè¯ã€‚ 

ğŸ‘‰ **Note:**  **å¯¹äºæœ€æ–°ç‰ˆæœ¬çš„blupADC,ç”¨æˆ·éœ€è¦é¦–å…ˆå®‰è£…`blupSUP` (ç¤ºä¾‹æ•°æ®å’Œè½¯ä»¶å‡å·²è¿ç§»è‡³è¯¥åŒ…ï¼Œe.g. DMU and BLUPF90)   **
---

## ç¤ºä¾‹

### å•æ€§çŠ¶BLUPåˆ†æ 

```{r include=FALSE}
library(blupADC)
``` 

```{r include=TRUE}
library(blupSUP)
library(blupADC)
data_path=system.file("extdata", package = "blupSUP")
#è®¾ç½®BLUPåˆ†æçš„å‚æ•°
blup_par=BLUPpar$new(
phe_file=paste0(data_path,"/phenotype.txt"),                                            
phe_colnames=c("Id","Mean","Sex","Herd_Year_Season","Litter","Trait1","Trait2","Age"),
dmu_integer_n=5, #number of integer variable in the phenotype file (required by DMU)
analysis_model="PBLUP_A",
kinship_file=paste0(data_path,"/pedigree.txt"))
#å®šä¹‰ Trait1çš„ æ•ˆåº”
myblup=BLUP$new(fixed=Trait1~Sex+Herd_Year_Season, #fixed effect
                random=~Id+Litter, #random effect 
                pars=blup_par) #blup_par has been defined previously
myblup
```

```{r eval=FALSE}
# Trait1çš„BLUPåˆ†æ
myblup$run(output_path="D:/test",task_type="DMU") # default using DMU 
#myblup$run(output_path="D:/test",task_type="BLUPF90") #using BLUPF90 for analysis 
```

```{r include=FALSE}
#BLUP analysis of Trait1
myblup$run(output_path="D:/test",task_type="DMU") # default using DMU 
#myblup$run(output_path="D:/test",task_type="BLUPF90") #using BLUPF90 for analysis 
```

```{r message=FALSE}
#Trait1çš„åˆ†æç»“æœ
ebv=myblup$ebv         #breeding value
h2=myblup$h2   #heritability and its SE
user_defined_h2=myblup$cal_se(~Id1/(Id1+Litter1+Res1)) #ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå®šä¹‰çš„è¡¨è¾¾å¼è®¡ç®—å¯¹åº”çš„é—ä¼ åŠ›åŠå…¶æ ‡å‡†è¯¯
```

```{r eval=FALSE}
#GBLUP-A åˆ†æ
myblup$pars$kinship_file=paste0(data_path,"/G_Ainv_col_three.txt")
myblup$pars$analysis_model="GBLUP_A"
myblup$run(task_type="DMU")
```

```{r eval=FALSE}
#ssGBLUP-A åˆ†æ
myblup$pars$kinship_file=paste0(data_path,"/",c("pedigree.txt","G_A_col_three.txt"))
myblup$pars$analysis_model="SSBLUP_A"
myblup$run(task_type="DMU")
```

### å¤šæ€§çŠ¶BLUPåˆ†æ 

``` R
library(blupSUP)
library(blupADC)
data_path=system.file("extdata", package = "blupSUP")
#prepare parameters the BLUP analysis
blup_par=BLUPpar$new(
phe_file=paste0(data_path,"/phenotype.txt"),                                               phe_colnames=c("Id","Mean","Sex","Herd_Year_Season","Litter","Trait1","Trait2","Age"),
dmu_integer_n=5, #number of integer variable in the phenotype file (required by DMU)
analysis_model="PBLUP_A",
kinship_file=paste0(data_path,"/pedigree.txt"))

#å®šä¹‰Trait1æ¨¡å‹ä¸­çš„æ•ˆåº”
myblup=BLUP$new(fixed=Trait1~Sex+Herd_Year_Season, #fixed effect
               random=~Id+Litter, #random effect 
               pars=blup_par) #blup_par has been defined previously
myblup$run(output_path="D:/test",task_type="DMU") # default using DMU 
myblup
```

``` {r include=FALSE}
library(blupSUP)
library(blupADC)
data_path=system.file("extdata", package = "blupSUP")
#prepare parameters the BLUP analysis
blup_par=BLUPpar$new(
phe_file=paste0(data_path,"/phenotype.txt"),                                               phe_colnames=c("Id","Mean","Sex","Herd_Year_Season","Litter","Trait1","Trait2","Age"),
dmu_integer_n=5, #number of integer variable in the phenotype file (required by DMU)
analysis_model="PBLUP_A",
kinship_file=paste0(data_path,"/pedigree.txt"))

#define the effect of Trait1 for BLUP analysis
myblup=BLUP$new(fixed=Trait1~Sex+Herd_Year_Season, #fixed effect
               random=~Id+Litter, #random effect 
               pars=blup_par) #blup_par has been defined previously
myblup$run(output_path="D:/test",task_type="DMU") # default using DMU 
```

``` {r include=TRUE}
myblup
#å¤šæ€§çŠ¶æ¨¡å‹åˆ†æ
#å®šä¹‰Trait2æ¨¡å‹ä¸­çš„æ•ˆåº”
myblup$add_model(fixed=Trait2~Herd_Year_Season,random=~Id,covariate=~Age)
myblup
```

``` R
myblup$run() #åˆ†æ

#åœ¨BLUPåˆ†æä¸­ï¼Œç§»é™¤ Trait2 
#myblup$rm_model("Trait2") 

#å¤šæ€§çŠ¶æ¨¡å‹åˆ†æçš„ç»“æœ
ebv=myblup$ebv         #breeding value
h2=myblup$h2   #heritability and its SE
genR2=myblup$r2 #genetic correlation and its SE 
user_defined_h2=myblup$cal_se(~Id1/(Id1+Litter1+Res1)) #user defined expression of calculating h2 based on delta method
user_defined_genR2=myblup$cal_se(~Id1_2/sqrt(Id1 * Id2)) #user defined expression of calculating genR2 based on delta method
#random effect names from multiple traits model were defined in: rownames(myblup$vars_se$vars_mat)         
```

### äº¤å‰éªŒè¯

``` R
library(blupSUP)
library(blupADC)
data_path=system.file("extdata", package = "blupSUP")

#prepare parameters the BLUP analysis
blup_par=BLUPpar$new(
phe_file=paste0(data_path,"/phenotype.txt"),                                               phe_colnames=c("Id","Mean","Sex","Herd_Year_Season","Litter","Trait1","Trait2","Age"),
dmu_integer_n=5, #number of integer variable in the phenotype file (required by DMU)
analysis_model="PBLUP_A",
kinship_file=paste0(data_path,"/pedigree.txt"))

#define the effect of Trait1 for BLUP analysis
myblup=BLUP$new(fixed=Trait1~Sex+Herd_Year_Season, #fixed effect
                random=~Id+Litter, #random effect 
                pars=blup_par) #blup_par has been defined previously


#åˆ©ç”¨ holdoutæ–¹å¼åˆ’åˆ†è®­ç»ƒç¾¤å’ŒéªŒè¯ç¾¤
myCV=CVpredi$new(myblup,  #has been defined previously 
                 partion_type="holdout", #the type of data partioning
                 ratio=0.6) #the ratio of  train_size/(train_size+test_size)

#è®¡ç®—é¢„æµ‹å‡†ç¡®æ€§
myCV$predict_sets()
accu=myCV$accuracy
bias=myCV$bias
train_set=myCV$datasets$train_sets[[1]] #train set was used in analysis
test_set=myCV$datasets$test_sets[[1]]   #train set was used in analysis 
ebv_set=myCV$datasets$ebv_sets[[1]]   #train set was used in analysis 

#åˆ©ç”¨ kfold åˆ’åˆ†è®­ç»ƒç¾¤å’ŒéªŒè¯ç¾¤ 
myCV=CVpredi$new(myblup,  #has been defined previously 
                 partion_type="kfold", #the type of data partioning
                 ratio=0.6,            #the ratio of  train_size/(train_size+test_size)
                 kfold=5,              #number of fold  
                 seed=9894)            #random seed number for partioning data,default is 9894     

#get the prediction accuracy 
myCV$predict_sets() #è®¡ç®—æ‰€æœ‰è®­ç»ƒç¾¤å’ŒéªŒè¯ç¾¤ä¸‹çš„æ¨¡å‹é¢„æµ‹å‡†ç¡®æ€§
#myCV$predict_sets(2) # ä»…è®¡ç®—ç¬¬2ä¸ªè®­ç»ƒç¾¤å’ŒéªŒè¯ç¾¤ä¸‹çš„æ¨¡å‹é¢„æµ‹å‡†ç¡®æ€§
accu=myCV$accuracy
bias=myCV$bias
train_set2=myCV$datasets$train_sets[[2]] #train set was used in analysis of fold2
test_set2=myCV$datasets$test_sets[[2]]   #train set was used in analysis  of fold2
ebv_set2=myCV$datasets$ebv_sets[[2]]   #train set was used in analysis  of fold2
```
