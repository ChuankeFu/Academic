---
title: 'R package:blupADC-使用说明6'
author: qsmei
date: '2021-04-20'
slug: run_dmu
categories:
  - DMU
tags: []
subtitle: ''
summary: 'R中运行DMU软件并完成相应的分析'
authors: []
lastmod: '2021-04-20T18:31:18+08:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

```{r}
    knitr::opts_chunk$set(collapse = TRUE)
```

🤠在讲述完各种各样的数据预处理方法后，我们正式进入到育种数据的分析层面。在目前的动植物育种领域，主要的育种软件包括但不限于以下两种：**DMU**和**BLUPf90**。这两款软件均是于上世纪80-90年代开发的，并且一直处于维护中。截至目前，两款软件的引用次数均已接近千次(实际可能更多), 这也足见这两款软件的认可度。

但是，这两款软件均存在一个共同的缺点，就是使用起来较为麻烦(需要提供准备好的参数文件)。笔者当时学习参数文件的配置时，前前后后花费了近一个月的时间，足以见这两款软件的不友好性🥶。

为此，我们在R中编写了相应的函数，使得用户可以轻松的完成两款软件参数文件的配置及对应的数据分析。本章我们主要讲述如何通过`BLUP_ADC`中的`run_DMU`函数，在R中调用**DMU**软件并完成数据分析。在下一章，我们将会讲述如何在R中调用**BLUPf90**软件，并完成数相应的据分析。

同样的，我们还是用一个简单的例子看看该函数的用法:

```{r}
#source("D:/test_code/BLUP_ADC_code/run_dmu.txt")
#source("D:/test_code/BLUP_ADC_code/cal_dmu_corrected_phe.txt")
#source("D:/test_code/BLUP_ADC_code/generate_dmu.DIR.txt")
#run_DMU(phe_col_names=c("Id","Sex","Herd_Year_Season","Litter", "Trait1"#,"Trait2","Age"),              #表型数据的列名
#        target_trait_name=c("Trait1"),                          # #目标性状名称
#        fixed_effect_name=list(c("Sex","Herd_Year_Season")),  ##固定效应名称
#        random_effect_name=list(c("Id","Litter")),            ##随机效应名称
#        covariate_effect_name=list(c("Age")),                 ##协变量名称
#        phe_path="D:/test_code/BLUP_ADC_code/DMU_example",
#        phe_name="dmu_phe.txt",
#        analysis_method="PBLUP_A",
#        integer_n=4,
#        dmu_module="dmuai",
#        relationship_path="D:/test_code/BLUP_ADC_code/DMU_example", ##系谱或基因型文件的路径
#		    relationship_name="Dmu_ped.txt",
#        output_result_path="C:/Users/26564/Desktop",
#		    output_ebv_path="C:/Users/26564/Desktop",
#		    output_ebv_name="test",
#        DMU_software_path="D:/QGG-DMUv6-2/R5.2/bin"
#        )
#
```

此外，我们还可以在上面代码的基础上稍作修改，就能够非常方便的完成多性状模型的运算，如下：

```{r}
#source("D:/test_code/BLUP_ADC_code/run_dmu.txt")
#source("D:/test_code/BLUP_ADC_code/cal_dmu_corrected_phe.txt")
#source("D:/test_code/BLUP_ADC_code/generate_dmu.DIR.txt")
#run_DMU(phe_col_names=c("Id","Sex","Herd_Year_Season","Litter", "Trait1"#,"Trait2","Age"),              #表型数据的列名
#        target_trait_name=c("Trait1","Trait2",                          # #目标性状名称
#        fixed_effect_name=list(c("Sex","Herd_Year_Season"),c("Sex")),  ##固定效应名称
#        random_effect_name=list(c("Id","Litter"),c("Id")),            ##随机效应名称
#        covariate_effect_name=list(c("Age"),NULL),                 ##协变量名称
#        phe_path="D:/test_code/BLUP_ADC_code/DMU_example",
#        phe_name="dmu_phe.txt",
#        analysis_method="PBLUP_A",
#        integer_n=4,
#        dmu_module="dmuai",
#        relationship_path="D:/test_code/BLUP_ADC_code/DMU_example", ##系谱或基因型文件的路径
#		    relationship_name="Dmu_ped.txt",
#        output_result_path="C:/Users/26564/Desktop",
#		    output_ebv_path="C:/Users/26564/Desktop",
#		    output_ebv_name="test",
#        DMU_software_path="D:/QGG-DMUv6-2/R5.2/bin"
#        )
#
```

接下来，我们将对run_DMU函数中的参数一一进行讲解：

-   参数1：`phe_path`

本地表型数据文件的路径。字符串格式。

-   参数2：`phe_name`

本地表型数据文件的名称。字符串格式。

-   参数3：`phe_col_names`

表型数据的列名。字符串向量格式。

-   参数4：`integer_n`

表型数据中，整型变量的数目。数字格式。

-   参数5：`genetic_effect_name`

遗传效应的名称(一般为个体号)。字符串格式。

-   参数6：`target_trait_name`

目标性状的名称。字符串向量格式。通过添加多个性状的名称，我们即可完成多性状模型的分析，e.g. `target_trait_name=c("Trait1","Trait2")` 即可完成 `Trait1` 和 `Trait2`的双性状模型

-   参数7：`fixed_effect_name`

目标性状的固定效应名称。列表格式。针对多性状模型，每个性状的固定效应名称对应列表中的具体位置的元素，e.g. `fixed_effect_name=list(c("Sex","Herd_Year_Season"),c("Sex"))` 其中，`c("Sex","Herd_Year_Season")` 是第一个性状的固定效应名称，`c("Sex")`是第二个性状的固定效应名称

-   参数8：`random_effect_name`

目标性状的随机效应名称。列表格式。针对多性状模型，每个性状的随机效应名称对应列表中的具体位置的元素，e.g. `fixed_effect_name=list(c("Id","Litter"),c("Id"))` 。 其中，`c("Id","Litter")` 是第一个性状的随机效应名称，`c("Sex")` 是第二个性状的随机效应名称

-   参数9：`covariate_effect_name`

目标性状的协变量效应名称。列表格式。针对多性状模型，每个性状的协变量效应名称对应列表中的具体位置的元素，e.g. `fixed_effect_name=list(c("Age"),NULL)` 。 其中，`c("Age")`是第一个性状的协变量效应名称，`NULL` 是第二个性状的协变量效应名称(`NULL`表示的是该性状无协变量效应)

-   参数10：`analysis_model`

遗传评估的分析模型。字符串格式。可选包括模型：

1.  `"PBLUP_A"` : 系谱-加性效应模型

2.  `"GBLUP_A"` :基因组-加性效应模型

3.  `"GBLUP_AD"` :基因组-加性-显性效应模型

4.  `"SSBLUP_A"` :一步法加性效应模型

5.  `"User_define"`: 用户自定义模型

-   参数11：`dmu_module`

DMU分析时使用的模块。字符串格式。可选模块包括：

1.  `"dmuai"`

2.  `"dmu4"`

3.  `"dmu5"`

-   参数12：`DMU_software_path`

DMU软件在本地的路径。字符串格式。

-   参数13：`relationship_path`

提供的亲缘关系文件的路径。字符串格式

-   参数14：`relationship_name`

提供的亲缘关系文件的名称。字符串向量格式。针对不同的遗传评估分析模型，我们需要提供不同类型的亲缘关系文件。针对 "PBLUP_A"模型，我们需要提供系谱文件,e.g. `relationship_name="pedigree.txt"` ；针对`"GBLUP_A"` 或 `"GBLUP_AD"`模型，我们需要提供基因组亲缘关系矩阵的逆矩阵文件, e.g. `relationship_name=c("G_A_inv_matrix.txt","G_D_inv_matrix.txt")`；针对 `"SSBLUP_A"`模型, 我们需要同时提供系谱文件及基因组亲缘关系矩阵的文件, e.g. `relationship_name=c("pedigree.txt","G_A_matrix.txt")` 。

-   参数15：`output_result_path`

DMU运行结果的保存路径。字符串格式。

-   参数16：`output_ebv_path`

输出的育种值、残差及校正表型文件的保存路径。字符串格式。

-   参数17：`output_ebv_name`

输出的育种值、残差及校正表型文件的名称。字符串格式。

#### **其他参数**

-   参数18：`provided_effect_file_path`

性状效应记录文件的路径。字符串格式。为了方便用户输入固定效应、随机效应及协变量效应，用户可以在本地直接提供相应的文件，格式如下所示：

| V1     | V2  | V3  | V4               | V5  | V6  | V7     | V8  | V9  |
|--------|-----|-----|------------------|-----|-----|--------|-----|-----|
| Trait1 | \*  | Sex | \*               | Id  | \*  | Age    | \*  |     |
| Trait2 | \*  | Sex | Herd_Year_Season | \*  | Id  | Litter | \*  | \*  |

每类效应都用\**隔开，每一列的间隔均为制表符间隔。每个性状所在的行均有4个，第1-2个\*之间的效应代表的是固定效应，第2-3个\** *之间的效应代表的是随机效应，第3-4个\** *之间的效应代表的是协变量效应。*

-   参数19：`provided_effect_file_name`

性状效应记录文件的名称。字符串格式。

-   参数20：`provided_DIR_file_path`

用户自己提供的DIR文件的路径。字符串格式

-   参数21：`provided_DIR_file_name`

用户自己提供的DIR文件的名称。字符串格式

-   参数22：`included_permanent_effect`

是否进行永久环境效应分析。逻辑值格式。默认为FASLE。

-   参数23：`dmu_algorithm_code`

DMU模块内的算法代码。数字格式。

-   参数24：`provided_prior_file_path`

用户提供的方差组分-PRIOR文件的路径。字符串格式。

-   参数25：`provided_prior_file_name`

用户提供的方差组分-PRIOR文件的名称。字符串格式。

-   参数26：`missing_value`

表型数据的缺失值。数字格式。默认为 -9999。

-   参数27：`iteration_criteria`

方差组分迭代收敛的标准。数字格式。默认为 1.0e-7。

-   参数28：`genetic_effect_number`

SOL文件中，遗传效应所代表的数字。数字格式。默认为4。

-   参数29：`residual_cov_trait`

残差协方差约束为0的性状。列表格式。e.g. 将Trait1和Trait2的残差协方差约束为0，`residual_cov_trait=list(c("Trait1","Trait2"))`

-   参数30：`selected_id`

只输出这部分个体的育种值、残差及校正表型。字符串向量格式。

-   参数31：`cal_debv`

是否计算DEBV。逻辑值。默认为FALSE。

-   参数32：`debv_pedigree_path`

计算DEBV时，提供的系谱文件的路径。字符串向量格式。

-   参数33：`debv_pedigree_name`

计算DEBV时，提供的系谱文件的名称。字符串向量格式。
